<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Posts</title>
  <link rel="stylesheet" href="./styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
  <div class="status box">
    <div class="status-menu">
      <a class="status-menu-item active" href="#">Status</a>
      <a class="status-menu-item" href="#">Photos</a>
      <a class="status-menu-item" href="#">Videos</a>
    </div>
    <div class="status-main">
      <img src="" class="status-img" />
      <textarea id="thoughts" class="status-textarea" placeholder="Write something you would like to share.."></textarea>
    </div>
    <div class="status-actions">
      <a href="#" class="status-action">
        <svg width="24" xmlns="http://www.w3.org/2000/svg" viewBox="-42 0 512 512">
          <!-- SVG content here -->
        </svg>
        People
      </a>
      <a href="#" class="status-action">
        <svg width="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
          <!-- SVG content here -->
        </svg>
        Check in
      </a>
      <a href="#" class="status-action">
        <svg width="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
          <!-- SVG content here -->
        </svg>
        Mood
      </a>
      <button id="shareButton" class="status-share">Share</button>
    </div>
  </div>

  <div id="postsContainer"></div>

  <div class="img-container">
    <img src="./images/electronicdreams77.jpg" alt="music-cover" id="cover" />
  </div>

  <div class="avatar-container">
    <div class="avatar">
      <img src="./images/pacificrim.jpg" alt="Avatar" class="avatar-img">
      <div class="username"></div>
    </div>
  </div>

  <!-- music player -->
  <div class="music-container">
    <div class="music-info">
      <h4 id="title">Lost in a Maze</h4>
      <div class="progress-container">
        <div class="progress"></div>
      </div>
    </div>
    <audio src="./music/Lost in a Maze.mp3" id="audio"></audio>
    <audio src="./music/Day Dreams.mp3" id="audio1"></audio>
    <div class="navigation"></div>
    <button id="prev" class="action-btn">
      <i class="fas fa-backward"></i>
    </button>
    <button id="play" class="action-btn">
      <i class="fas fa-play"></i>
    </button>
    <button id="next" class="action-btn">
      <i class="fas fa-forward"></i>
    </button>
  </div>

  <script>
    // Function to handle post creation
    document.getElementById('shareButton').addEventListener('click', async () => {
      const thoughts = document.getElementById('thoughts').value;
      const userId = 1; // Replace with the logged-in user's ID (you may need to get this dynamically)

      if (!thoughts) {
        alert('Please enter your thoughts.');
        return;
      }

      const response = await fetch('/api/posts', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ thoughts, userId }),
      });

      if (response.ok) {
        document.getElementById('thoughts').value = '';
        loadPosts();
      } else {
        const error = await response.json();
        alert('Error: ' + error.message);
      }
    });

    // Function to load posts and display them
    async function loadPosts() {
      try {
        const response = await fetch('/api/posts');
        const result = await response.json();

        if (result.status === 'success') {
          const posts = result.data;
          const postsContainer = document.getElementById('postsContainer');
          postsContainer.innerHTML = posts.map(post => `
            <div class="album box">
              <div class="status-main">
                <div class="album-detail">
                  <div class="album-title"><strong>${post.username}</strong> created a new <span>Post</span></div>
                  <div class="album-date">${post.createdAt}</div>
                </div>
              </div>
              <div class="album-content">${post.thoughts}</div>
              <div class="album-actions">
                <button onclick="deletePost(${post.id})">Delete</button>
              </div>
            </div>
          `).join('');
        } else {
          alert('Error: ' + result.message);
        }
      } catch (error) {
        console.error('Error fetching posts:', error);
        alert('Failed to fetch posts.');
      }
    }

    // Function to delete a post
    async function deletePost(postId) {
      try {
        const response = await fetch(`/api/posts/${postId}`, {
          method: 'DELETE',
        });

        if (response.ok) {
          alert('Post deleted successfully.');
          loadPosts();
        } else {
          const error = await response.json();
          alert('Error: ' + error.message);
        }
      } catch (error) {
        console.error('Error deleting post:', error);
        alert('Failed to delete post.');
      }
    }

    // Load posts on page load
    loadPosts();
  </script>
</body>
</html>
